<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å±±å½¢å±‹ è‚‰ã‚¬ãƒãƒ£</title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    background:#fff8f0;
    padding: 40px 16px;
  }
  h1 {
    color: #d84315;
  }
  #roulette-container {
    margin: 40px auto;
    width: 300px;
    height: 300px;
    position: relative;
  }
  #roulette {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 5px solid #d84315;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
    transition: transform 5s cubic-bezier(0.33, 1, 0.68, 1);
  }
  #pointer {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 0; 
    height: 0; 
    border-left: 15px solid transparent;
    border-right: 15px solid transparent;
    border-bottom: 30px solid #d84315;
  }
  button {
    margin-top: 20px;
    padding: 18px 32px;
    font-size: 22px;
    background: #ff7043;
    border: none;
    border-radius: 10px;
    color: white;
    cursor: pointer;
  }
  button:disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  #result, #info {
    margin-top: 20px;
    font-size: 20px;
    font-weight: bold;
    color: #6d4c41;
    min-height: 32px;
    white-space: pre-line;
  }
</style>
</head>
<body>

<h1>å±±å½¢å±‹ è‚‰ã‚¬ãƒãƒ£</h1>
<p>1é€±é–“ã«1å›æŒ‘æˆ¦ã§ãã¾ã™!</p>

<div id="roulette-container">
  <div id="pointer"></div>
  <canvas id="roulette"></canvas>
</div>

<button id="drawButton">ã‚¬ãƒãƒ£ã‚’å›ã™</button>
<p id="result"></p>
<p id="info"></p>

<script>
const prizes = [
  { name: "ğŸ– æ¥µä¸Šå’Œç‰› 200g", chance: 3 },
  { name: "ğŸ¥ˆ åšåˆ‡ã‚Šä¸Šã‚¿ãƒ³ 150g", chance: 7 },
  { name: "ğŸº ãƒ‰ãƒªãƒ³ã‚¯1æ¯", chance: 20 },
  { name: "ğŸ’´ æ¬¡å›10%OFF", chance: 30 },
  { name: "ğŸ˜„ ã¾ãŸæŒ‘æˆ¦ã—ã¦ã­", chance: 40 }
];

const drawButton = document.getElementById("drawButton");
const resultElem = document.getElementById("result");
const infoElem = document.getElementById("info");
const canvas = document.getElementById('roulette');
const ctx = canvas.getContext('2d');
const size = canvas.width = canvas.height = 300;
const center = size/2;
const radius = center - 10;

// æ–‡å­—ãªã—ã®ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæç”»ï¼ˆè‰²åˆ†ã‘ã®ã¿ï¼‰
function drawRoulette() {
  const total = prizes.reduce((sum, p) => sum + p.chance, 0);
  let startAngle = 0;

  prizes.forEach(p => {
    const sliceAngle = (p.chance / total) * 2 * Math.PI;
    ctx.beginPath();
    ctx.moveTo(center, center);
    ctx.arc(center, center, radius, startAngle, startAngle + sliceAngle);
    ctx.fillStyle = `hsl(${Math.random()*360}, 70%, 70%)`;
    ctx.fill();
    ctx.stroke();
    startAngle += sliceAngle;
  });
}

drawRoulette();

// 1é€±é–“åˆ¶é™ãƒã‚§ãƒƒã‚¯
const lastDateStr = localStorage.getItem("gachaDate");
let canDraw = true;

if (lastDateStr) {
  const lastDate = new Date(lastDateStr);
  const now = new Date();
  const diffDays = Math.floor((now - lastDate)/(1000*60*60*24));
  if (diffDays < 7) {
    canDraw = false;
    drawButton.disabled = true;
    const nextDate = new Date(lastDate);
    nextDate.setDate(nextDate.getDate()+7);
    infoElem.innerText = `æœ€å¾Œã«æŒ‘æˆ¦ã—ãŸæ—¥: ${lastDate.toLocaleDateString()} \næ¬¡å›æŒ‘æˆ¦å¯èƒ½æ—¥: ${nextDate.toLocaleDateString()}`;
  }
}

drawButton.onclick = () => {
  drawButton.disabled = true;

  // æœ¬å½“ã®æŠ½é¸
  let rand = Math.random() * 100;
  let sum = 0;
  let prize = "ğŸ˜¢ å¤–ã‚Œ";
  for (let p of prizes) {
    sum += p.chance;
    if (rand < sum) {
      prize = p.name;
      break;
    }
  }

  // å›è»¢è§’åº¦
  const total = prizes.reduce((sum, p) => sum + p.chance, 0);
  let angle = 0;
  for (let p of prizes) {
    const slice = (p.chance / total) * 360;
    if (p.name === prize) break;
    angle += slice;
  }

  const rotation = 360*5 - angle + Math.random()*10;
  canvas.style.transition = "transform 5s cubic-bezier(0.33, 1, 0.68, 1)";
  canvas.style.transform = `rotate(${rotation}deg)`;

  setTimeout(() => {
    resultElem.innerText = "ğŸ‰ " + prize + " ğŸ‰";
    const today = new Date();
    localStorage.setItem("gachaDate", today.toISOString());

    const nextDate = new Date(today);
    nextDate.setDate(today.getDate()+7);
    infoElem.innerText = `æœ€å¾Œã«æŒ‘æˆ¦ã—ãŸæ—¥: ${today.toLocaleDateString()} \næ¬¡å›æŒ‘æˆ¦å¯èƒ½æ—¥: ${nextDate.toLocaleDateString()}`;
  }, 5000);
}
</script>

</body>
</html>
